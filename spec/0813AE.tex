\section{Аутентифицированное шифрование}\label{PRG.AE}

\subsection{Интерфейс}\label{PRG.AE.IFace}

Аутентифицированное шифрование задается алгоритмом установки 
защиты $\algname{bash-prg-ae}$ и алгоритмом снятия защиты
$\algname{bash-prg-ae}^{-1}$. Параметрами алгоритмов являются 
уровень стойкости $\ell\in\{128,192,256\}$ и емкость $d\in\{1,2\}$. 

Входными данными $\algname{bash-prg-ae}[\ell,d]$ являются 
анонс~$A\in\{0,1\}^{32*}$, сообщение~$X\in\{0,1\}^{8*}$, ассоциированные
данные~$I\in\{0,1\}^{8*}$ и ключ~$K\in\{0,1\}^{32*}$.
%
Длины $A$ и $K$ должны быть не больше $480$, длина~$K$ должна быть не 
меньше~$\ell$.

Выходными данными $\algname{bash-prg-ae}[\ell,d]$ являются 
зашифрованное сообщение~$Y\in\{0,1\}^{|X|}$ и имитовставка~$T\in\{0,1\}^\ell$.

Входными данными $\algname{bash-prg-ae}^{-1}[\ell,d]$ являются 
анонс~$A\in\{0,1\}^{32*}$, зашифрованное сообщение~$Y\in\{0,1\}^{8*}$, 
ассоциированные данные~$I\in\{0,1\}^{8*}$, имитовставка~$T\in\{0,1\}^\ell$ 
и ключ~$K\in\{0,1\}^{32*}$.
%
Длины $A$ и $K$ должны быть не больше $480$, длина~$K$ должна быть не 
меньше~$\ell$.

Выходными данными $\algname{bash-prg-ae}^{-1}[\ell,d]$ являются 
либо признак ошибки~$\perp$, либо расшифрованное сообщение~$X\in\{0,1\}^{|Y|}$. 
%
Возврат~$\perp$ означает нарушение целостности входных данных.

\subsection{Переменные}\label{PRG.AE.Vars}

В обоих алгоритмах используется автомат~$\alpha$.

В алгоритме снятия защиты расшифрованное сообщение~$X$
считается переменной вплоть до проверки имитовставки (шаг 4).
Если имитовставка признана некорректной, то переменная должна быть 
очищена в соответствии с правилами~\ref{COMMON.Vars}.

\subsection{Алгоритм установки защиты}\label{PRG.AE.Wrap}

Установка защиты $\algname{bash-prg-ae}[\ell,d](A,X,I,K)$ выполняется следующим 
образом:
\begin{enumerate}
\item
Выполнить $\alpha.\algname{start}[\ell,d](A,K)$.
\item
Обработать $(X,I)$:
\begin{enumerate}
\item
$\alpha.\algname{absorb}(I)$;
\item
$Y\leftarrow\alpha.\algname{encrypt}(X)$;
\item
$T\leftarrow \alpha.\algname{squeeze}(\ell)$;
\item
возвратить $(Y,T)$.
\end{enumerate}
\end{enumerate}

\begin{note}
Если $I=\perp$, то шаг~2.1 может быть пропущен.
%
Если $X=\perp$, то шаг~2.2 может быть упрощен: $Y\leftarrow\perp$.
%
Пропуск и (или) упрощение шагов должны зеркально повторяться в алгоритме снятия 
защиты (см. примечание 5).
\end{note}

\begin{note}
После возврата $(Y,T)$ работу с автоматом
можно продолжить и обработать новую пару~$(X,I)$, повторяя шаг 2.
\end{note}

\begin{note}
Перед обработкой новой пары~$(X,I)$ можно ввести новые анонс~$A$ и ключ~$K$ с 
помощью команды~$\alpha.\algname{restart}(A, K)$.
\end{note}

\begin{note}
После обработки~$(X,I)$ можно вызвать 
команду~$\alpha.\algname{ratchet}(\perp)$. Вызов блокирует определение~$X$ 
по~$(Y,I)$ даже после раскрытия состояния автомата.
\end{note}

\subsection{Алгоритм снятия защиты}\label{PRG.AE.Unwrap}

Снятие защиты $\algname{bash-prg-ae}^{-1}[\ell,d](A,Y,I,T,K)$ выполняется 
следующим образом:
\begin{enumerate}
\item
Выполнить $\alpha.\algname{start}[\ell,d](A,K)$.
\item
Обработать $(Y,I,T)$:
\begin{enumerate}
\item
$\alpha.\algname{absorb}(I)$;
\item
$X\leftarrow\alpha.\algname{decrypt}(Y)$;
\item
если $T\neq\alpha.\algname{squeeze}(\ell)$, то возвратить~$\perp$;
\item
возвратить $X$.
\end{enumerate}
\end{enumerate}

\begin{note}
Расширения алгоритма установки защиты в соответствии с примечаниями~1--4 
зеркально переносятся на алгоритм снятия защиты с одним уточнением: после 
возврата~$\perp$ обработка новых троек~$(Y,I,T)$ должна быть прекращена.
\end{note}
